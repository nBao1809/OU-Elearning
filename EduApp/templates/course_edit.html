{% extends 'layout/base.html' %}
{% block title %}Ch·ªânh s·ª≠a kh√≥a h·ªçc - EduOnline{% endblock %}

{% block content %}
<div class="container edit-course">
  <h1 class="page-title">Ch·ªânh s·ª≠a kh√≥a h·ªçc</h1>

  <!-- Th√¥ng tin kh√≥a h·ªçc -->
  <section class="card mb-4">
    <h2 class="card-title">Th√¥ng tin kh√≥a h·ªçc</h2>

    <div class="form-row mb-3">
      <label for="course-title-{{ course.id }}">T√™n kh√≥a h·ªçc</label>
      <input type="text" class="form-control" id="course-title-{{ course.id }}" value="{{ course.title }}">
      <button class="btn btn-outline btn-sm mt-2"
              onclick="updateCourseField({{ course.id }}, 'title', document.getElementById('course-title-{{ course.id }}').value)">
        L∆∞u
      </button>
    </div>

    <div class="form-row">
      <label for="course-desc-{{ course.id }}">M√¥ t·∫£</label>
      <textarea class="form-control" rows="3" id="course-desc-{{ course.id }}">{{ course.description }}</textarea>
      <button class="btn btn-outline btn-sm mt-2"
              onclick="updateCourseField({{ course.id }}, 'description', document.getElementById('course-desc-{{ course.id }}').value)">
        L∆∞u
      </button>
    </div>
  </section>

  <!-- Modules & Lessons -->
  <section class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2 class="card-title">Modules & Lessons</h2>
      <button type="button" class="btn btn-outline btn-sm" onclick="addModule({{ course.id }})">
        + Th√™m module
      </button>
    </div>

    <div class="card-body">
      {% for module in course.modules %}
      <div class="module-card mb-3 p-2 border rounded" id="module-{{ module.id }}">

        <!-- Module Header -->
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h3>Module {{ loop.index }}</h3>
          <button type="button" class="btn btn-sm btn-outline" onclick="addLesson({{ module.id }})">
            + Th√™m lesson
          </button>
        </div>

        <!-- Module Title -->
        <input type="text" class="form-control mb-2" id="module-title-{{ module.id }}" value="{{ module.title }}">

        <!-- Lessons -->
        <ul class="list-group">
          {% for lesson in module.lessons %}
          <li class="list-group-item lesson-item" data-lesson-id="{{ lesson.id }}">
            <div class="lesson-row d-flex gap-2 flex-wrap align-items-start">

              <!-- Ti√™u ƒë·ªÅ -->
              <input type="text" class="form-control form-control-sm w-50"
                     id="lesson-title-{{ lesson.id }}" value="{{ lesson.title }}">

              <!-- Ki·ªÉu n·ªôi dung -->
              <select class="form-select form-select-sm w-25"
                      id="lesson-type-{{ lesson.id }}"
                      onchange="document.getElementById('lesson-content-{{ lesson.id }}').value=''; renderPreview({{ lesson.id }});">
                <option value="text"   {% if lesson.text_content %}selected{% endif %}>Text</option>
                <option value="video"  {% if lesson.video_url %}selected{% endif %}>Video</option>
                <option value="file"   {% if lesson.file_url %}selected{% endif %}>File</option>
              </select>

              <!-- N·ªôi dung -->
              <input type="text" class="form-control form-control-sm w-75"
                     id="lesson-content-{{ lesson.id }}"
                     value="{{ lesson.video_url or lesson.file_url or lesson.text_content }}"
                     oninput="renderPreview({{ lesson.id }})">

            </div>

            <!-- Preview -->
            <div id="lesson-preview-{{ lesson.id }}" class="lesson-preview mt-2"></div>
          </li>
          {% endfor %}
        </ul>

        <!-- N√∫t l∆∞u chung -->
        <button class="btn btn-primary btn-sm mt-3"
                onclick="saveModule({{ module.id }})">
          üíæ L∆∞u Module & Lessons
        </button>
      </div>
      {% endfor %}
    </div>
  </section>
</div>

<!-- G·∫Øn CSS + JS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/create_course.css') }}">
<script src="{{ url_for('static', filename='js/course_edit.js') }}"></script>
{% endblock %}
